jQuery(document).ready(function(a){"undefined"!=typeof analyticsData&&(!function(){const a=document.getElementById("revenue-chart");a&&new Chart(a,{type:"line",data:{labels:analyticsData.revenueChart.dates,datasets:[{label:"Dnevni Prihod (BAM)",data:analyticsData.revenueChart.revenues,borderColor:"#4CAF50",backgroundColor:"rgba(76, 175, 80, 0.1)",tension:.4,fill:!0,borderWidth:3,pointRadius:4,pointHoverRadius:6,pointBackgroundColor:"#4CAF50"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",padding:12,titleFont:{size:14},bodyFont:{size:13},callbacks:{label:function(a){return"Prihod: "+a.parsed.y.toFixed(2)+" BAM"}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(a){return a+" BAM"},font:{size:12}},grid:{color:"rgba(0, 0, 0, 0.05)"}},x:{grid:{display:!1},ticks:{font:{size:11}}}}}})}(),function(){const a=document.getElementById("driver-revenue-chart");a&&new Chart(a,{type:"bar",data:{labels:analyticsData.driverRevenue.driver_names,datasets:[{label:"Prihod (BAM)",data:analyticsData.driverRevenue.revenues,backgroundColor:"rgba(255, 165, 0, 0.7)",borderColor:"rgba(255, 165, 0, 1)",borderWidth:2,borderRadius:6}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",padding:12,callbacks:{label:function(a){return"Prihod: "+a.parsed.y.toFixed(2)+" BAM"}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(a){return a+" BAM"},font:{size:12}},grid:{color:"rgba(0, 0, 0, 0.05)"}},x:{grid:{display:!1},ticks:{font:{size:10},maxRotation:45,minRotation:45}}}}})}(),function(){const a=document.getElementById("peak-hours-chart");a&&new Chart(a,{type:"bar",data:{labels:analyticsData.peakHours.hours,datasets:[{label:"Broj Rezervacija",data:analyticsData.peakHours.counts,backgroundColor:"rgba(33, 150, 243, 0.7)",borderColor:"rgba(33, 150, 243, 1)",borderWidth:2,borderRadius:6}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",padding:12,callbacks:{label:function(a){return"Rezervacije: "+a.parsed.y}}}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1,font:{size:12}},grid:{color:"rgba(0, 0, 0, 0.05)"}},x:{grid:{display:!1},ticks:{font:{size:10},maxRotation:0,minRotation:0}}}}})}(),function(){const a=document.getElementById("status-pie-chart");a&&new Chart(a,{type:"pie",data:{labels:analyticsData.statusDistribution.labels,datasets:[{data:analyticsData.statusDistribution.counts,backgroundColor:["rgba(255, 193, 7, 0.8)","rgba(33, 150, 243, 0.8)","rgba(76, 175, 80, 0.8)","rgba(244, 67, 54, 0.8)","rgba(158, 158, 158, 0.8)"],borderColor:["rgba(255, 193, 7, 1)","rgba(33, 150, 243, 1)","rgba(76, 175, 80, 1)","rgba(244, 67, 54, 1)","rgba(158, 158, 158, 1)"],borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{font:{size:13},padding:15,usePointStyle:!0}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",padding:12,callbacks:{label:function(a){const t=a.label||"",e=a.parsed||0;return t+": "+e+" ("+(e/a.dataset.data.reduce((a,t)=>a+t,0)*100).toFixed(1)+"%)"}}}}}})}(),a("#analytics-filters").on("submit",function(t){t.preventDefault(),function(){const t=a("#analytics-start-date").val(),e=a("#analytics-end-date").val(),n=a("#analytics-group-by").val(),i=a("#report-table-body");i.html('<tr><td colspan="7" style="text-align: center; padding: 40px;"><div class="spinner is-active" style="float: none;"></div> Učitavanje izvještaja...</td></tr>'),a.ajax({url:cityride_admin_ajax.ajax_url,type:"POST",data:{action:"cityride_get_analytics_data",nonce:cityride_admin_ajax.nonce,start_date:t,end_date:e,group_by:n},success:function(a){if(a.success&&a.data.length>0){let t="";a.data.forEach(function(a){t+="<tr>",t+="<td>"+a.period+"</td>",t+="<td>"+a.total_rides+"</td>",t+="<td>"+a.completed_rides+"</td>",t+="<td>"+a.cancelled_rides+"</td>",t+="<td>"+parseFloat(a.total_revenue).toFixed(2)+" BAM</td>",t+="<td>"+parseFloat(a.avg_ride_value).toFixed(2)+" BAM</td>",t+="<td>"+parseFloat(a.cancellation_rate).toFixed(1)+"%</td>",t+="</tr>"}),i.html(t)}else i.html('<tr><td colspan="7" style="text-align: center; padding: 40px; color: #999;">Nema podataka za odabrani period.</td></tr>')},error:function(){i.html('<tr><td colspan="7" style="text-align: center; padding: 40px; color: red;">Greška pri učitavanju izvještaja.</td></tr>')}})}()}),a("#export-analytics-excel").on("click",function(t){t.preventDefault(),function(){const t=a("#analytics-start-date").val(),e=a("#analytics-end-date").val(),n=a("#analytics-group-by").val(),i=a("<form>",{method:"POST",action:cityride_admin_ajax.ajax_url});i.append(a("<input>",{type:"hidden",name:"action",value:"cityride_export_analytics_excel"})),i.append(a("<input>",{type:"hidden",name:"nonce",value:cityride_admin_ajax.nonce})),i.append(a("<input>",{type:"hidden",name:"start_date",value:t})),i.append(a("<input>",{type:"hidden",name:"end_date",value:e})),i.append(a("<input>",{type:"hidden",name:"group_by",value:n})),a("body").append(i),i.submit(),i.remove()}()}))});